<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chat â€” Cloud Optimizer</title>
    <link href="./vendor/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="./css/dashboard.css" rel="stylesheet">
    <style>
      /* Chat Container */
      .chat-container{
        background:linear-gradient(135deg,rgba(15,23,36,0.95) 0%,rgba(7,16,34,0.95) 100%);
        border-radius:16px;
        border:1px solid rgba(255,255,255,0.06);
        box-shadow:0 8px 32px rgba(0,0,0,0.3);
        overflow:hidden;
      }
      
      /* Chat Header */
      .chat-header{
        background:linear-gradient(90deg,rgba(13,110,253,0.15) 0%,rgba(25,135,84,0.15) 100%);
        padding:1.25rem 1.5rem;
        border-bottom:1px solid rgba(255,255,255,0.08);
      }
      .chat-header-row{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:1rem;
        flex-wrap:wrap;
      }
      .chat-info{
        display:flex;
        align-items:center;
        gap:1rem;
        flex:1;
        min-width:0;
      }
      .client-name-display{
        color:#4ade80;
        font-weight:600;
        font-size:1rem;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
        display:none;
      }
      .chat-controls{
        display:flex;
        align-items:center;
        gap:0.75rem;
        flex-shrink:0;
      }
      
      /* Status Badge */
      .status-badge{
        display:inline-flex;
        align-items:center;
        padding:0.375rem 0.875rem;
        border-radius:20px;
        font-size:0.8rem;
        font-weight:500;
        transition:all 0.3s ease;
      }
      .status-badge.online{
        background:rgba(40,167,69,0.2);
        color:#4ade80;
        border:1px solid rgba(40,167,69,0.3);
      }
      .status-badge.offline{
        background:rgba(108,117,125,0.2);
        color:#94a3b8;
        border:1px solid rgba(108,117,125,0.3);
      }
      .status-dot{
        width:8px;
        height:8px;
        border-radius:50%;
        display:inline-block;
        margin-right:0.5rem;
        animation:pulse 2s infinite;
      }
      .status-online{background:#4ade80}
      .status-offline{background:#94a3b8}
      @keyframes pulse{
        0%,100%{opacity:1}
        50%{opacity:0.5}
      }
      
      /* Chat Window */
      .chat-window{
        height:58vh;
        overflow-y:auto;
        padding:1.5rem;
        background:rgba(0,0,0,0.2);
        scroll-behavior:smooth;
      }
      .chat-window::-webkit-scrollbar{width:8px}
      .chat-window::-webkit-scrollbar-track{background:rgba(255,255,255,0.02);border-radius:4px}
      .chat-window::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:4px}
      .chat-window::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.15)}
      
      /* Message Bubbles */
      .message-wrapper{
        display:flex;
        margin-bottom:1.25rem;
        animation:fadeIn 0.3s ease;
      }
      @keyframes fadeIn{
        from{opacity:0;transform:translateY(10px)}
        to{opacity:1;transform:translateY(0)}
      }
      
      .message-wrapper.user{
        justify-content:flex-end;
      }
      .message-wrapper.assistant{
        justify-content:flex-start;
      }
      
      .message-avatar{
        width:36px;
        height:36px;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:600;
        font-size:0.875rem;
        flex-shrink:0;
      }
      .message-wrapper.user .message-avatar{
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        color:#fff;
        margin-left:0.75rem;
        order:2;
      }
      .message-wrapper.assistant .message-avatar{
        background:linear-gradient(135deg,#0ea5e9 0%,#0d9488 100%);
        color:#fff;
        margin-right:0.75rem;
      }
      
      .message-content{
        max-width:65%;
        display:flex;
        flex-direction:column;
      }
      
      .message-bubble{
        padding:0.875rem 1.125rem;
        border-radius:16px;
        word-wrap:break-word;
        position:relative;
        box-shadow:0 2px 8px rgba(0,0,0,0.15);
      }
      
      .message-wrapper.user .message-bubble{
        background:linear-gradient(135deg,rgba(102,126,234,0.25) 0%,rgba(118,75,162,0.25) 100%);
        border:1px solid rgba(102,126,234,0.3);
        color:#e0e7ff;
        border-bottom-right-radius:4px;
      }
      
      .message-wrapper.assistant .message-bubble{
        background:linear-gradient(135deg,rgba(14,165,233,0.15) 0%,rgba(13,148,136,0.15) 100%);
        border:1px solid rgba(14,165,233,0.25);
        color:#e6eef9;
        border-bottom-left-radius:4px;
      }
      
      .message-time{
        font-size:0.7rem;
        color:rgba(230,238,249,0.5);
        margin-top:0.375rem;
        padding:0 0.25rem;
      }
      .message-wrapper.user .message-time{
        text-align:right;
      }
      
      /* Typing Indicator */
      .typing-indicator{
        display:flex;
        align-items:center;
        padding:0.875rem 1.125rem;
        background:linear-gradient(135deg,rgba(14,165,233,0.15) 0%,rgba(13,148,136,0.15) 100%);
        border:1px solid rgba(14,165,233,0.25);
        border-radius:16px;
        border-bottom-left-radius:4px;
        max-width:65%;
      }
      .typing-indicator .dot{
        width:8px;
        height:8px;
        border-radius:50%;
        background:#0ea5e9;
        margin:0 3px;
        animation:typing 1.4s infinite;
      }
      .typing-indicator .dot:nth-child(1){animation-delay:0s}
      .typing-indicator .dot:nth-child(2){animation-delay:0.2s}
      .typing-indicator .dot:nth-child(3){animation-delay:0.4s}
      @keyframes typing{
        0%,60%,100%{transform:translateY(0);opacity:0.4}
        30%{transform:translateY(-8px);opacity:1}
      }
      
      /* Chat Footer */
      .chat-footer{
        padding:1.25rem 1.5rem;
        background:rgba(0,0,0,0.2);
        border-top:1px solid rgba(255,255,255,0.08);
      }
      
      .chat-input-wrapper{
        display:flex;
        gap:0.75rem;
        align-items:flex-end;
      }
      
      #chatInput{
        flex:1;
        background:rgba(255,255,255,0.05);
        border:1px solid rgba(255,255,255,0.1);
        color:#fff;
        padding:0.875rem 1.125rem;
        border-radius:24px;
        transition:all 0.3s ease;
      }
      #chatInput:focus{
        background:rgba(255,255,255,0.08);
        border-color:rgba(102,126,234,0.5);
        box-shadow:0 0 0 3px rgba(102,126,234,0.1);
        outline:none;
      }
      #chatInput::placeholder{
        color:rgba(230,238,249,0.4);
      }
      
      #sendBtn{
        padding:0.875rem 1.75rem;
        border-radius:24px;
        font-weight:500;
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        border:none;
        transition:all 0.3s ease;
        box-shadow:0 4px 12px rgba(102,126,234,0.3);
      }
      #sendBtn:hover:not(:disabled){
        transform:translateY(-2px);
        box-shadow:0 6px 16px rgba(102,126,234,0.4);
      }
      #sendBtn:disabled{
        opacity:0.6;
        cursor:not-allowed;
      }
      
      /* Client Selector */
      #clientSelector{
        background:rgba(255,255,255,0.08);
        border:1px solid rgba(255,255,255,0.15);
        color:#fff;
        border-radius:8px;
        padding:0.5rem 1rem;
        min-width:250px;
        max-width:350px;
        font-size:0.9rem;
        cursor:pointer;
      }
      #clientSelector:focus{
        background:rgba(255,255,255,0.12);
        border-color:rgba(102,126,234,0.5);
        box-shadow:0 0 0 3px rgba(102,126,234,0.1);
        outline:none;
      }
      #clientSelector option{
        background:#0f1724;
        color:#fff;
      }
      
      /* Loading Overlay */
      .loader-overlay{
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:rgba(0,0,0,0.85);
        backdrop-filter:blur(4px);
        display:none;
        align-items:center;
        justify-content:center;
        z-index:9999;
      }
      .loader-overlay.show{display:flex}
      .spinner-border{width:3rem;height:3rem}
      
      /* Responsive */
      @media (max-width:768px){
        .message-content{max-width:85%}
        .chat-window{height:55vh}
        .chat-header-row{flex-direction:column;align-items:stretch}
        .chat-info{flex-direction:column;align-items:stretch;gap:0.5rem}
        .chat-controls{justify-content:space-between;width:100%}
        #clientSelector{max-width:100%}
      }
    </style>
  </head>
  <body class="bg-dark-login">
    <nav class="navbar navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="./dashboard.html">Cloud Optimizer</a>
      <div>
        <a class="btn btn-sm btn-outline-light me-2" href="./clients.html">Back to Clients</a>
        <div class="dropdown d-inline-block">
          <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <span id="navUsername">User</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" aria-labelledby="userDropdown">
            <li><span class="dropdown-item-text small"><strong id="dropdownUsername">User</strong></span></li>
            <li><span class="dropdown-item-text small text-muted" id="dropdownRole">Role: member</span></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" id="signOut">Sign Out</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Loading Overlay -->
    <div id="loader" class="loader-overlay">
      <div class="text-center">
        <div class="spinner-border text-light" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="text-light mt-2" id="loaderText">Loading...</div>
      </div>
    </div>

    <div class="container-fluid dashboard-layout mt-3">
      <div class="row">
        <div class="col-12 col-lg-10 offset-lg-1">
          <div class="chat-container">
            
            <!-- Chat Header -->
            <div class="chat-header">
              <div class="chat-header-row">
                <div class="chat-info">
                  <select id="clientSelector" class="form-select">
                    <option value="">-- Select a client --</option>
                  </select>
                  <span id="clientNameDisplay" class="client-name-display"></span>
                </div>
                <div class="chat-controls">
                  <span id="wsStatus" class="status-badge offline">
                    <span class="status-dot status-offline"></span>
                    Disconnected
                  </span>
                  <button id="connectBtn" class="btn btn-sm btn-outline-light">Connect</button>
                  <button id="disconnectBtn" class="btn btn-sm btn-outline-light d-none">Disconnect</button>
                </div>
              </div>
            </div>

            <!-- Chat Window -->
            <div id="chatWindow" class="chat-window" aria-live="polite" aria-atomic="false"></div>

            <!-- Chat Footer -->
            <div class="chat-footer">
              <form id="chatForm">
                <div class="chat-input-wrapper">
                  <input id="chatInput" class="form-control" placeholder="Type your message here..." autocomplete="off">
                  <button id="sendBtn" class="btn btn-primary" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right:4px">
                      <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                    </svg>
                    Send
                  </button>
                </div>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>

    <script src="./vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/permissions.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/chat.js"></script>
  </body>
</html>
